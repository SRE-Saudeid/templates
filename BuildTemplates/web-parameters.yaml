# Repo: templates/
# File: azure-pipelines.yml
parameters:
- name: environment
  type: object
  default: []
- name: coveragetest
  type: boolean
  default: false
- name: bucket
  type: object
  default: []

stages:
- stage: Development
  condition: contains(variables['Build.SourceBranch'], 'refs/heads/dev')
  jobs:
  - template: webapp-pipeline.yaml@templates
    parameters:
        stage: Development      
        environment: dev
        bucket: dev-${{ parameters.bucket }}
        coveragetest: ${{ parameters.coveragetest }}
- stage: Quality
  condition: or(contains(variables['Build.SourceBranch'], 'refs/heads/release'), contains(variables['Build.SourceBranch'], 'refs/heads/hotfix'))
  jobs:
  - template: webapp-pipeline.yaml@templates
    parameters:
        stage: Quality      
        environment: dev
        bucket: qa-${{ parameters.bucket }}
        coveragetest: ${{ parameters.coveragetest }}
- stage: Production
  condition: or(contains(variables['Build.SourceBranch'], 'refs/heads/release'), contains(variables['Build.SourceBranch'], 'refs/heads/hotfix'))
  jobs:
  - template: webapp-pipeline.yaml@templates
    parameters:
        stage: Production      
        environment: prod
        bucket: prod-${{ parameters.bucket }}
        coveragetest: ${{ parameters.coveragetest }}

