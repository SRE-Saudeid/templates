pool:
  name: Azure Pipelines
steps:
- task: Docker@0
  displayName: 'Build an image'
  inputs:
    containerregistrytype: 'Container Registry'
    imageName: '$(Build.Repository.Name)'
    includeLatestTag: true

- task: AmazonWebServices.aws-vsts-tools.ECRPushImage.ECRPushImage@1
  displayName: 'Push Image: '
  inputs:
    awsCredentials: 'AWS-CREDENTIALS-DEV'
    regionName: 'sa-east-1'
    sourceImageName: '$(Build.Repository.Name)'
    repositoryName: 'b2c/api-assinatura'

- task: AmazonWebServices.aws-vsts-tools.AWSCLI.AWSCLI@1
  displayName: 'AWS CLI: ecs  '
  inputs:
    awsCredentials: 'AWS-CREDENTIALS-DEV'
    regionName: 'sa-east-1'
    awsCommand: 'ecs  '
    awsSubCommand: 'update-service'
    awsArguments: '--cluster subscription-container --service update-service --force-new-deployment'
    failOnStandardError: false

